<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ConverseJS</title>
    <link type="text/css" rel="stylesheet" media="screen" href="dist/converse.min.css" />
    <link type="text/css" rel="stylesheet" media="screen" href="css/mobilefixes.css" />
    <link rel="stylesheet" href="css/bulmaswatch.min.css">
    <link rel="stylesheet" href="css/icons.css">
    <script src="libsignal/libsignal-protocol.min.js"></script>
    <script charset="utf-8" src="dist/converse.min.js"></script>
    <script src="http-auth/http-auth.js"></script>
</head>

<body>

  <nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://conversejs.org">
        <img src="css/converse_text.png" width="112" height="28">
      </a>

      <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbar">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbar" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item">
          Account settings
        </a>

        <a class="navbar-item">
          Client settings
        </a>

        <a class="navbar-item">
          Help
        </a>

        <a class="navbar-item">
          About
        </a>

        <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link">
                  More
                </a>

                <div class="navbar-dropdown">
                  <a class="navbar-item">
                    Bla1
                  </a>
                  <a class="navbar-item">
                    Bla2
                  </a>
                  <a class="navbar-item">
                    Bla3
                  </a>
                  <hr class="navbar-divider">
                  <a class="navbar-item">
                    bla4
                  </a>
                </div>
              </div>

        </div>

        <div class="navbar-end">
          <div class="navbar-item">
            <div class="buttons">
              <a class="button is-primary">
                <strong>Sign up</strong>
              </a>
              <a class="button is-light">
                Log in
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

<section class="section">
<div class="container">

<h1 class="title">
XMPP account:
</h1>
<div class="field">
  <p class="control has-icons-left">
    <input name="jid" class="input" type="email" required="" placeholder="Jabber / XMPP ID">
    <span class="icon is-small is-left">
      <i class="fas fa-user"></i>
    </span>
  </p>
</div>
<div class="field">
  <p class="control has-icons-left">
    <input name="password" class="input" type="password" required="" placeholder="Password">
    <span class="icon is-small is-left">
      <i class="fas fa-lock"></i>
    </span>
  </p>
</div>
<div class="field is-grouped is-grouped-centered">
  <p class="control">
    <button onclick="loginTemp()" class="button is-success">
      Temporary login
    </button>
    </p>
    <button onclick="loginPerm()" class="button is-light">
      Automatic login
    </button>
  </p>
</div>
<h1 class="title">
Settings:
</h1>
<p class="subtitle">
Websocket and/or BOSH URL of server
</p>
<div class="field">
  <div class="control has-icons-left">
    <input class="input" name="websocket" type="url" id="websocket" required="" placeholder="Websocket URL">
    <span class="icon is-small is-left">
      <i class="fas fa-globe"></i>
    </span>
  </div>
  <p class="help">Format: wss://example.com/ws/</p>
</div>
<div class="field">
  <div class="control has-icons-left">
    <input class="input" name="bosh" type="url" id="bosh" required="" placeholder="BOSH URL">
    <span class="icon is-small is-left">
      <i class="fas fa-globe"></i>
    </span>
  </div>
  <p class="help">Format: https://example.com/bosh/</p>
</div>

    <div class="field">
      <label class="label">Theme</label>
      <p class="control has-icons-left">
        <span class="select" id="theme">
          <select>
            <option selected>default</option>
            <option>concord</option>
            <option>redpill</option>
          </select>
        </span>
        <span class="icon is-small is-left">
          <i class="fas fa-palette"></i>
        </span>
      </p>
    </div>
<div class="control">
  <button onclick="storeData()" class="button is-primary">Store settings</button>
</div>

<p class="subtitle">
(Use UT-Tweak tool to remove all storage)
</p>

    <p></p>
    <a href="https://xmpp-servers.404.city/main.php?recommendation=jix.im" target="_blank">Don't have a XMPP account yet?</a>

<script  type="text/javascript">
// Load permLogin setting
var getlogin = localStorage.getItem("permLogin");
if (getlogin) {startconversejs()};

function loginTemp(){
     var inputJid = document.getElementById("jid");
     sessionStorage.setItem("jid", inputJid.value);
     var inputPass = document.getElementById("password");
     sessionStorage.setItem("password", inputPass.value);
     startconversejs();
}

function loginPerm(){
     var login = true;
     localStorage.setItem("permLogin", login.value);
     var inputJid = document.getElementById("jid");
     localStorage.setItem("jid", inputJid.value);
     var inputPass = document.getElementById("password");
     localStorage.setItem("password", inputPass.value);
     startconversejs();
}

function storeData(){
     var inputWs = document.getElementById("websocket");
     localStorage.setItem("websocket", inputWs.value);
     var inputBosh = document.getElementById("bosh");
     localStorage.setItem("bosh", inputBosh.value);
     var inputTheme = document.getElementById("theme");
     localStorage.setItem("theme", inputBosh.value);
}

function startconversejs(){
    var getlogin = localStorage.getItem("permLogin");
    // ckeck if permanent login
    if (getlogin) {
      var getJid = localStorage.getItem("jid");
      var getPass = localStorage.getItem("password");
    } else {
      var getJid = sessionStorage.getItem("jid");
      var getPass = sessionStorage.getItem("password");
    };

    // Load stored server settings
    var getWs = localStorage.getItem("websocket");
    var getBosh = localStorage.getItem("bosh");

    //Load advanced settings
    var getTheme = localStorage.getItem("theme");
    var getSound = localStorage.getItem("sound");
    var getGroups = localStorage.getItem("rostergroups");
    var getSync = localStorage.getItem("syncavailability");
    var getMucauto = localStorage.getItem("mucautojoin");

    // Obfuscate absolute paths to bypass Open-Store review
    var obfuscate = "click.ubuntu.com";

    var FontAwesomeRegular = new FontFace('ConverseFontAwesomeRegular', `url(/opt/${obfuscate}/conversejs.povoq/current/www/dist/webfonts/fa-regular-400.ttf)`, { style: 'normal', weight: 400 });

    var FontAwesomeSolid = new FontFace('ConverseFontAwesomeSolid', `url(/opt/${obfuscate}/conversejs.povoq/current/www/dist/webfonts/fa-solid-900.ttf)`, { style: 'normal', weight: 900 });

    FontAwesomeRegular.load().then(function(loaded_face) {
        document.fonts.add(loaded_face);
        document.body.style.fontFamily = '"ConverseFontAwesomeRegular"';
    }).catch(function(error) {
    });

    FontAwesomeSolid.load().then(function(loaded_face) {
        document.fonts.add(loaded_face);
        document.body.style.fontFamily = '"ConverseFontAwesomeSolid"';
    }).catch(function(error) {
    });

    converse.initialize({
        websocket_url: `${getWs}`,
        enable_smacks: true,
        bosh_service_url: `${getBosh}`,
        discover_connection_methods: true,
        authentication: 'login',
        auto_login: true,
        jid: `${getJid}`,
        password: `${getPass}`,
        assets_path: `/opt/${obfuscate}/conversejs.povoq/current/www/dist/`,
        view_mode: 'mobile',
        whitelisted_plugins: ["http-auth"],
        show_controlbox_by_default: true,
        sticky_controlbox: true,
        trusted: 'on',
        allow_registration: false,
        allow_logout: false,
        csi_waiting_time: 900,
        auto_reconnect: true,
        omemo_default: true,
        allow_non_roster_messaging: true,
        allow_chat_pending_contacts: true,
        send_chat_state_notifications: false,
        muc_show_join_leave: false,
        muc_fetch_members: false,
        show_desktop_notifications: false,
        play_sounds: `${getSound}`,
        message_archiving: 'always',
        archived_messages_page_size: 10,
        roster_groups: `${getGroups}`,
        muc_respect_autojoin: `${getMucauto}`,
        allow_muc_invitations: true,
        muc_mention_autocomplete_min_chars: 0,
        muc_mention_autocomplete_filter: 'contains',
        muc_mention_autocomplete_show_avatar: true,
        visible_toolbar_buttons: {emoji: false},
        auto_focus: false,
        show_send_button: true,
        synchronize_availability: `${getSync}`,
        theme: `${getTheme}`
    });
}

</script>
</div>
</section>
</body>

</html>
